import{f as S,y as L,n as Te,p as Ie,A as R,_ as Ae,q as Oe,R as He,T as pe,v as We,r as ze,d as _e,u as X,g as ke,a as Ne}from"./index-BAvY3pQe.js";import{C as je}from"./Card-CGofTpKP.js";import"./Image-BKAtRhsX.js";const $e=n=>{const[e,t]=S({width:0,height:0});return L(()=>{const{current:o}=n;if(!o)return;const r=new ResizeObserver(Te(()=>{t({width:o.clientWidth,height:o.clientHeight})},50));return r.observe(o),()=>{r.disconnect()}},[n.current]),e},Be=()=>{const[n,e]=S({width:window.innerWidth,height:window.innerHeight});return Ie(()=>{const t=()=>{e({width:window.innerWidth,height:window.innerHeight})};return t(),window.addEventListener("resize",t),window.addEventListener("orientationchange",t),()=>{window.removeEventListener("resize",t),window.removeEventListener("orientationchange",t)}},[]),n},Ue=(n,{threshold:e=0,thresholdPercent:t=0})=>{const[o,r]=S(!1);return L(()=>{const{current:i}=n;if(!i)return;const s=()=>{const c=i.getBoundingClientRect(),u=window.innerHeight,f=e||(1-t)*c.height,a=c.bottom<=u+f;r(a)};return s(),window.addEventListener("scroll",s),()=>{window.removeEventListener("scroll",s)}},[n.current,e,t]),o},C=0,p=1,qe=2,Fe=0,G=1;function De(n,e,t){let o=n.list,r;for(;o;){if(o.index===t)return!1;if(e>o.high)break;r=o,o=o.next}return r||(n.list={index:t,high:e,next:o}),r&&(r.next={index:t,high:e,next:r.next}),!0}function Ke(n,e){let t=n.list;if(t.index===e)return t.next===null?Fe:(n.list=t.next,G);let o=t;for(t=t.next;t!==null;){if(t.index===e)return o.next=t.next,G;o=t,t=t.next}}const m={low:0,max:0,high:0,C:qe,P:void 0,R:void 0,L:void 0,list:void 0};m.P=m;m.L=m;m.R=m;function E(n){const e=n.high;n.L===m&&n.R===m?n.max=e:n.L===m?n.max=Math.max(n.R.max,e):n.R===m?n.max=Math.max(n.L.max,e):n.max=Math.max(Math.max(n.L.max,n.R.max),e)}function B(n){let e=n;for(;e.P!==m;)E(e.P),e=e.P}function _(n,e){if(e.R===m)return;const t=e.R;e.R=t.L,t.L!==m&&(t.L.P=e),t.P=e.P,e.P===m?n.root=t:e===e.P.L?e.P.L=t:e.P.R=t,t.L=e,e.P=t,E(e),E(t)}function k(n,e){if(e.L===m)return;const t=e.L;e.L=t.R,t.R!==m&&(t.R.P=e),t.P=e.P,e.P===m?n.root=t:e===e.P.R?e.P.R=t:e.P.L=t,t.R=e,e.P=t,E(e),E(t)}function U(n,e,t){e.P===m?n.root=t:e===e.P.L?e.P.L=t:e.P.R=t,t.P=e.P}function Ye(n,e){let t;for(;e!==m&&e.C===p;)e===e.P.L?(t=e.P.R,t.C===C&&(t.C=p,e.P.C=C,_(n,e.P),t=e.P.R),t.L.C===p&&t.R.C===p?(t.C=C,e=e.P):(t.R.C===p&&(t.L.C=p,t.C=C,k(n,t),t=e.P.R),t.C=e.P.C,e.P.C=p,t.R.C=p,_(n,e.P),e=n.root)):(t=e.P.L,t.C===C&&(t.C=p,e.P.C=C,k(n,e.P),t=e.P.L),t.R.C===p&&t.L.C===p?(t.C=C,e=e.P):(t.L.C===p&&(t.R.C=p,t.C=C,_(n,t),t=e.P.L),t.C=e.P.C,e.P.C=p,t.L.C=p,k(n,e.P),e=n.root));e.C=p}function Ve(n){for(;n.L!==m;)n=n.L;return n}function Je(n,e){let t;for(;e.P.C===C;)e.P===e.P.P.L?(t=e.P.P.R,t.C===C?(e.P.C=p,t.C=p,e.P.P.C=C,e=e.P.P):(e===e.P.R&&(e=e.P,_(n,e)),e.P.C=p,e.P.P.C=C,k(n,e.P.P))):(t=e.P.P.L,t.C===C?(e.P.C=p,t.C=p,e.P.P.C=C,e=e.P.P):(e===e.P.L&&(e=e.P,k(n,e)),e.P.C=p,e.P.P.C=C,_(n,e.P.P)));n.root.C=p}function Qe(){const n={root:m,size:0},e={};return{insert(t,o,r){let i=n.root,s=m;for(;i!==m&&(s=i,t!==s.low);)t<i.low?i=i.L:i=i.R;if(t===s.low&&s!==m){if(!De(s,o,r))return;s.high=Math.max(s.high,o),E(s),B(s),e[r]=s,n.size++;return}const c={low:t,high:o,max:o,C,P:s,L:m,R:m,list:{index:r,high:o,next:null}};s===m?n.root=c:(c.low<s.low?s.L=c:s.R=c,B(c)),Je(n,c),e[r]=c,n.size++},remove(t){const o=e[t];if(o===void 0)return;delete e[t];const r=Ke(o,t);if(r===void 0)return;if(r===G){o.high=o.list.high,E(o),B(o),n.size--;return}let i=o,s=i.C,c;o.L===m?(c=o.R,U(n,o,o.R)):o.R===m?(c=o.L,U(n,o,o.L)):(i=Ve(o.R),s=i.C,c=i.R,i.P===o?c.P=i:(U(n,i,i.R),i.R=o.R,i.R.P=i),U(n,o,i),i.L=o.L,i.L.P=i,i.C=o.C),E(c),B(c),s===p&&Ye(n,c),n.size--},search(t,o,r){const i=[n.root];for(;i.length!==0;){const s=i.pop();if(!(s===m||t>s.max)&&(s.L!==m&&i.push(s.L),s.R!==m&&i.push(s.R),s.low<=o&&s.high>=t)){let c=s.list;for(;c!==null;)c.high>=t&&r(c.index,s.low),c=c.next}}},get size(){return n.size}}}const ge=n=>{const e=R(n);return L(()=>{e.current=n}),e};function Xe(n,e,t,o){const r=R(t),i=R(o);L(()=>{r.current=t,i.current=o}),L(()=>{const s=n&&"current"in n?n.current:n;if(!s)return;let c=0;function u(...a){c||r.current.apply(this,a)}s.addEventListener(e,u);const f=i.current;return()=>{c=1,s.removeEventListener(e,u),f&&f()}},[n,e])}const D=(n,e)=>{const t=e||Ze;let o,r;return function(){return o&&t(arguments,o)?r:r=n.apply(null,o=arguments)}},Ze=(n,e)=>n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3];class le{constructor(){this.set=void 0,this.get=void 0;let e,t;this.get=o=>o===e?t:void 0,this.set=(o,r)=>{e=o,t=r}}}const Z=n=>{try{return new n}catch{const t={};return{set(o,r){t[o]=r},get(o){return t[o]}}}},Ge=n=>{const e=n.length,t=Z(n[0]);let o,r,i,s;const c=e===1,u=l=>(o=t.get(l[0]))===void 0||c?o:o.get(l[1]),f=(l,d)=>(c?t.set(l[0],d):(o=t.get(l[0]))===void 0?(r=Z(n[1]),r.set(l[1],d),t.set(l[0],r)):o.set(l[1],d),d),a=l=>{for(s=t,i=0;i<e;i++)if((s=s.get(l[i]))===void 0)return;return s},h=(l,d)=>{for(s=t,i=0;i<e-1;i++)(r=s.get(l[i]))===void 0&&(r=Z(n[i+1]),s.set(l[i],r)),s=r;return s.set(l[e-1],d),d};return e<3?{g:u,s:f}:{g:a,s:h}},Pe=(n,e)=>{let t;const{g:o,s:r}=Ge(n);return function(){return(t=o(arguments))===void 0?r(arguments,e.apply(null,arguments)):t}},x=new WeakMap;function ve(){const n=S(xe)[1];return R(()=>n({})).current}const xe={},q=Ae;function et(n){let{positioner:e,resizeObserver:t,items:o,as:r="div",id:i,className:s,style:c,role:u="grid",tabIndex:f=0,containerRef:a,itemAs:h="div",itemStyle:l,itemHeightEstimate:d=300,itemKey:P=ot,overscanBy:g=2,scrollTop:v,isScrolling:w,height:b,render:O,onRender:I}=n,H=0,T;const Le=ve(),ne=rt(e,t),K=o.length,{columnWidth:N,columnCount:ye,range:be,estimateHeight:Me,size:Ee,shortestColumn:Se}=e,j=Ee(),oe=Se(),Y=[],ie=u==="list"?"listitem":u==="grid"?"gridcell":void 0,V=ge(I);g=b*g;const re=v+g,J=oe<re&&j<K;if(be(Math.max(0,v-g/2),re,(y,M,$)=>{const W=o[y],Q=P(W,y),ce={top:$,left:M,width:N,writingMode:"horizontal-tb",position:"absolute"};Y.push(q(h,{key:Q,ref:ne(y),role:ie,style:typeof l=="object"&&l!==null?Object.assign({},ce,l):ce},ue(O,y,W,N))),T===void 0?(H=y,T=y):(H=Math.min(H,y),T=Math.max(T,y))}),J){const y=Math.min(K-j,Math.ceil((v+g-oe)/d*ye));let M=j;const $=it(N);for(;M<j+y;M++){const W=o[M],Q=P(W,M);Y.push(q(h,{key:Q,ref:ne(M),role:ie,style:typeof l=="object"?Object.assign({},$,l):$},ue(O,M,W,N)))}}L(()=>{typeof V.current=="function"&&T!==void 0&&V.current(H,T,o),ae="1"},[H,T,o,V]),L(()=>{J&&Le()},[J,e]);const se=tt(w,Me(K,d));return q(r,{ref:a,key:ae,id:i,role:u,className:s,tabIndex:f,style:typeof c=="object"?nt(se,c):se,children:Y})}let ae="0";const ue=Pe([le,{},WeakMap,le],(n,e,t,o)=>q(n,{index:e,data:t,width:o})),tt=D((n,e)=>({position:"relative",width:"100%",maxWidth:"100%",height:Math.ceil(e),maxHeight:Math.ceil(e),willChange:n?"contents":void 0,pointerEvents:n?"none":void 0})),we=(n,e)=>n[0]===e[0]&&n[1]===e[1],nt=D((n,e)=>Object.assign({},n,e),we);function ot(n,e){return e}const it=D(n=>({width:n,zIndex:-1e3,visibility:"hidden",position:"absolute",writingMode:"horizontal-tb"}),(n,e)=>n[0]===e[0]),rt=D((n,e)=>t=>o=>{o!==null&&(e&&(e.observe(o),x.set(o,t)),n.get(t)===void 0&&n.set(t,o.offsetHeight))},we);let Ce="undefined",A=typeof window!==Ce?window:{},st=typeof performance!==Ce?performance:Date,ee=()=>st.now(),Re="AnimationFrame",fe="cancel"+Re,de="request"+Re,F=A[de]&&A[de].bind(A),te=A[fe]&&A[fe].bind(A);function ct(n){return clearTimeout(n)}if(!F||!te){let n=0;F=e=>{let t=ee(),o=Math.max(n+1e3/60,t);return setTimeout(()=>{e(n=o)},o-t)},te=ct}const lt=n=>{te(n.v||-1)},at=(n,e)=>{const t=ee(),o={},r=()=>{ee()-t>=e?n.call(null):o.v=F(r)};return o.v=F(r),o},ut=typeof performance<"u"?performance:Date,ft=()=>ut.now();function dt(n,e=30,t=!1){const o=ge(n),r=1e3/e,i=R(0),s=R(),c=()=>s.current&&clearTimeout(s.current),u=[e,t,o];function f(){i.current=0,c()}return L(()=>f,u),Oe(function(){const a=arguments,h=ft(),l=()=>{i.current=h,c(),o.current.apply(null,a)},d=i.current;if(t&&d===0)return l();if(h-d>r){if(d>0)return l();i.current=h}c(),s.current=setTimeout(()=>{l(),i.current=0},r)},u)}function ht(n,e,t){const o=S(n);return[o[0],dt(o[1],e,t)]}const z=typeof window>"u"?null:window,he=()=>z.scrollY!==void 0?z.scrollY:z.pageYOffset===void 0?0:z.pageYOffset,mt=(n=30)=>{const e=ht(typeof window>"u"?0:he,n,!0);return Xe(z,"scroll",()=>e[1](he())),e[0]};function pt(n,e){n===void 0&&(n=0),e===void 0&&(e=12);const t=mt(e),[o,r]=S(!1),i=R(0);return L(()=>{i.current===1&&r(!0);let s=!1;const c=at(()=>{s||r(!1)},40+1e3/e);return i.current=1,()=>{s=!0,lt(c)}},[e,t]),{scrollTop:Math.max(0,t-n),isScrolling:o}}const gt=He[typeof document<"u"&&document.createElement!==void 0?"useLayoutEffect":"useEffect"];function Pt(n,e){e===void 0&&(e=vt);const[t,o]=S({offset:0,width:0});return gt(()=>{const{current:r}=n;if(r!==null){let i=0,s=r;do i+=s.offsetTop||0,s=s.offsetParent;while(s);(i!==t.offset||r.offsetWidth!==t.width)&&o({offset:i,width:r.offsetWidth})}},e),t}const vt=[];function wt(n,e){let{width:t,columnWidth:o=200,columnGutter:r=0,rowGutter:i,columnCount:s,maxColumnCount:c}=n;e===void 0&&(e=yt);const u=()=>{const[P,g]=Lt(t,o,r,s,c);return Ct(g,P,r,i??r)},f=R();f.current===void 0&&(f.current=u());const a=R(e),h=[t,o,r,i,s,c],l=R(h),d=!h.every((P,g)=>l.current[g]===P);if(d||!e.every((P,g)=>a.current[g]===P)){const P=f.current,g=u();if(a.current=e,l.current=h,d){const v=P.size();for(let w=0;w<v;w++){const b=P.get(w);g.set(w,b!==void 0?b.height:0)}}f.current=g}return f.current}const Ct=function(n,e,t,o){t===void 0&&(t=0),o===void 0&&(o=t);const r=Qe(),i=new Array(n),s=[],c=new Array(n);for(let u=0;u<n;u++)i[u]=0,c[u]=[];return{columnCount:n,columnWidth:e,set:function(u,f){f===void 0&&(f=0);let a=0;for(let l=1;l<i.length;l++)i[l]<i[a]&&(a=l);const h=i[a]||0;i[a]=h+f+o,c[a].push(u),s[u]={left:a*(e+t),top:h,height:f,column:a},r.insert(h,h+f,u)},get:u=>s[u],update:u=>{const f=new Array(n);let a=0,h=0;for(;a<u.length-1;a++){const l=u[a],d=s[l];d.height=u[++a],r.remove(l),r.insert(d.top,d.top+d.height,l),f[d.column]=f[d.column]===void 0?l:Math.min(l,f[d.column])}for(a=0;a<f.length;a++){if(f[a]===void 0)continue;const l=c[a],d=Rt(l,f[a]),P=c[a][d],g=s[P];for(i[a]=g.top+g.height+o,h=d+1;h<l.length;h++){const v=l[h],w=s[v];w.top=i[a],i[a]=w.top+w.height+o,r.remove(v),r.insert(w.top,w.top+w.height,v)}}},range:(u,f,a)=>r.search(u,f,(h,l)=>a(h,s[h].left,l)),estimateHeight:(u,f)=>{const a=Math.max(0,Math.max.apply(null,i));return u===r.size?a:a+Math.ceil((u-r.size)/n)*f},shortestColumn:()=>i.length>1?Math.min.apply(null,i):i[0]||0,size(){return r.size},all(){return s}}},Rt=(n,e)=>{let t=0,o=n.length-1;for(;t<=o;){const r=t+o>>>1,i=n[r];if(i===e)return r;i<=e?t=r+1:o=r-1}return-1},Lt=function(n,e,t,o,r){return n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=8),o=o||Math.min(Math.floor((n+t)/(e+t)),r||1/0)||1,[Math.floor((n-t*(o-1))/o),o]},yt=[];var me=function(e){var t=[],o=null,r=function(){for(var s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];t=c,!o&&(o=requestAnimationFrame(function(){o=null,e.apply(void 0,t)}))};return r.cancel=function(){o&&(cancelAnimationFrame(o),o=null)},r};function bt(n){const e=ve(),t=Et(n,e);function o(){return t.disconnect()}return L(()=>o,[t]),t}function Mt(n){n.cancel()}const Et=Pe([WeakMap],(n,e)=>{const t=[],o=me(()=>{t.length>0&&(n.update(t),e(t)),t.length=0}),r=f=>{const a=f.offsetHeight;if(a>0){const h=x.get(f);if(h!==void 0){const l=n.get(h);l!==void 0&&a!==l.height&&t.push(h,a)}}o()},i=new Map,s=f=>{let a=0;for(;a<f.length;a++){const h=f[a],l=x.get(h.target);if(l===void 0)continue;let d=i.get(l);d||(d=me(r),i.set(l,d)),d(h.target)}},c=new ResizeObserver(s),u=c.disconnect.bind(c);return c.disconnect=()=>{u(),i.forEach(Mt)},c}),St=({index:n,width:e,data:t})=>{const o=pe(()=>n%2?e/.65:e/.7,[e]);return t.title?X(Ne,{href:`/animes/${t.id}`,className:"flex",style:{height:o},children:X(je,{image:ke(`/animes/${t.id}.webp`),title:t.title,description:`第${t.eps}话`,extra:`${t.diff}更新`,titleClassName:"text-base sm:text-lg text-pretty"})}):X("div",{className:"flex bg-zinc-100 rounded-xl",style:{height:o}})},Ot=()=>{const[n,e]=S(Array.from({length:12}).map((v,w)=>({id:w}))),t=R(null),{width:o}=Be(),r=pe(()=>o<640?2:o<768?3:o<1024?4:o<1280||o<1536?5:o<1728?6:7,[o]),{width:i}=$e(t),s=window.innerHeight,{offset:c}=Pt(t),{scrollTop:u,isScrolling:f}=pt(c),a=wt({width:i,columnCount:r,columnGutter:12,rowGutter:12}),h=bt(a),l=et({containerRef:t,scrollTop:u,isScrolling:f,height:s,positioner:a,resizeObserver:h,items:n,itemKey:v=>v.id,render:St}),d=Ue(t,{thresholdPercent:.8}),P=R(0),g=R(1);return L(()=>{const{current:v}=P,{current:w}=g;!d&&v>0||v!==w&&We({page:v+1}).then(b=>{P.current=b.page,g.current=b.pages;const O=b.animes.map(I=>({...I,diff:ze(_e(I.updated).fromNow())}));e(v===0?O:I=>[...I??[],...O])})},[d]),L(()=>()=>{P.current=0,g.current=1,e([])},[]),l};export{Ot as default};
